<!DOCTYPE html>

<html>
<head>
  <meta charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>REGISTER PAGE</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
  *{
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }
  body{
    line-height: 1.6;
    background: #fff;
  }
  form{
    width: 98%;
    max-width: 1200px;
    display: flex;
    flex-direction: column;
    justify-content: center;
   /* box-shadow: 0 8px 16px #3a71ad;*/
    margin: 0 auto;
    padding: 0 15px;
  }
  h1{
    text-align: center;
    font-size: 24px;
    color: #000000;
    margin-bottom: 10px;
  }
  .username{
    width: 100%;
    background: rgba(100,100,100,0.1);
    color: #000000;
    border: none;
    padding: 20px 15px;
    font-size: 20px;  
  }
  .username input{
    width: 100%;
    padding: 15px 20px;
    border: 2px solid rgba(100,100,100,0.2);
    font-size: 20px;
  }
  .email{
    width: 100%;
    color: #000000;
    background: rgba(100,100,100,0.1);
    margin-top: 20px;
    padding: 20px 15px;
    font-size: 20px;
  }
  .email input{
    width: 100%;
    padding: 15px 20px;
    border: 2px solid rgba(100,100,100,0.2);
    font-size: 20px;
  }
  .number{
    margin-top: 20px;
    width: 100%;
    padding: 20px 15px;
    background: rgba(100,100,100,0.1);
    font-size: 20px;
  }
  .number input{
    width: 100%;
    padding: 15px 20px;
    border: 2px solid rgba(100,100,100,0.2);
    font-size: 20px;
  }
  .sex{
    width: 100%;
    margin-top: 20px;
    font-size: 20px;
    padding: 20px 15px;
    background: rgba(100,100,100,0.1);
  }
  .sex select{
    width: 100%;
    padding: 15px 20px;
    border: 2px solid rgba(100,100,100,0.2);
    font-size: 20px;
  }
  .photo{
    width: 100%;
    margin-top: 20px;
    background: rgba(150,150,150,0.1);
    font-size: 20px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 20px 15px;
    text-decoration: none;
  }
  .photo input{
    display: none;
  }
  .preview-container {
            margin: 25px 0;
            display: nonne;
        }
  .photo img{
    width: 150px;
    height: 150px;
    color: blue;
    object-fit: cover;
    border-radius: 50%;
    border: 1px solid rgba(100,100,100,0.6);
    margin: 0 auto;
    display: block;
    filter: drop-shadow(0 0 5px rgba(0, 255, 255, 0.5));
  }
  .photo button {
            background-color: #10b981;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            outline:0;
            transition: background-color 0.3s;
            display: none;
            margin: 0 auto;
        }
        
        .photo button:hover {
            background-color: #0da271;
        }
  .file-label {
            display: block;
            padding: 15px 20px;
            background-color: #4a6cf7;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-weight: 500;
        }
        
        .file-label:hover {
            background-color: #3b5be3;
        }
  .password {
    width: 100%;
    margin-top: 20px;
    padding: 20px 15px;
    background: rgba(150,150,150,0.1);
    font-size: 20px;
  }
 /* .password-box{
    width: 100%;
    padding:20x 15px;
    border: 2px solid rgba(100,100,100,0.2);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }*/
  .password input{
    width: 100%;
    padding: 20px;
    border: 2px solid rgba(100,100,100,0.2);
    font-size: 20px;
  }
  .password ul{
    padding: 10px 15px;
  }
  .show-hide {
    width: 100%;
    margin-top: 20px;
    font-size: 1.2rem;
    padding: 10px 5px;
  }
 
  .show-hide input{
    width: 20px;
    height: 20px;
  }
  .flash-container {
    position: fixed;
    top: 0;
    width: 100%;
    text-align: center;
    padding: 10px 0;
    z-index: 1000;
    background: rgba(255, 255, 255, 0.9);
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    display: none;
  }
  .flashed-message {
    color: red;
    font-size: 20px;
    font-weight: bold;
    text-align: center;
    max-width: 80%;
    margin: 0 auto;
    padding: 5px;
    word-wrap: break-word;
  }
  button{
    width: 80%;
    padding: 10px 15px;
    border: none;
    cursor: pointer;
    font-size: 20px;
    border-radius: 20px;
    margin: 20px;
    outline: 0;
    color: #fff;
    background: #041f7f;
  }
  button:hover{
    color: #041f7f;
    background: #fff;
    box-shadow: 0 5px 15px #041f7f;
  }
  .check{
    width: 100%;
    font-size: 18px;
    margin-bottom: 2vh;
    display: flex;
    align-items: center;
  }
  .check::before,
  .check::after{
    content: '';
    flex: 1;
    padding: 0 15px;
    border-bottom: 1px solid rgba(100,100,100,0.6);
  }
  .check a{
    text-decoration: none;
  }
  h1{
    font-size: 1.7em;
    text-shadow: 0 2px 10px rgba(255,0,0,0.5);
    color: rgba(0,0,250,0.6);
  }
  h2{
    color: rgba(0,0,250,0.6);
    opacity: 80%;
  }
  
  .validation-error{
    color: red;
    font-size: 16px;
    margin-top: 5px;
    display: none;
  }
  
  /* Responsive design */
  @media (max-width: 992px){
    h1{
      font-size: 2.8rem;
    }
    h2{
      font-size: 2rem;
    }
  }
  
  @media (max-width: 768px){
    h1{
      font-size: 2.3rem;
    }
    h2{
      font-size: 1.6rem;
    }
  }
  
  @media (max-width: 560px){
    h1{
      font-size: 2rem;
    }
    h2{
      font-size: 1.2rem;
    }
  }
  </style>
</head>
<body>
  <div class="flash-container">
  {% with messages = get_flashed_messages() %}
  {% if messages %}
    {% for message in messages %}
      <div class="flashed-message">{{ message }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}
    </div>
  
  <form method="POST" action="/register" enctype="multipart/form-data">
    <h1>CREATE YOUR ACCOUNT.</h1>
    <div class="username">
      <label for="username"><h2>Enter your username.</h2></label>
      <p>Your username should be unique from other users. You will be asked to enter this username whenever you request to login.</p>
    <input type="text" id="username" name="username" placeholder="eg. Machiya_08"required>
       <div class="validation-error" id="username-error"></div>
    </div>
    
    <div class="email">
      <label for="email"><h2>Enter your email.</h2></label>
      <p>The email you enter here will be used for security purposes and authentication. It will not be visible to other users.</p>
    <input type="email" id="email" name="email" placeholder="eg. machiya@gmail.com"required>
       <div class="validation-error" id="email-error"></div>
    </div>
    
    <div class="number">
      <label for="tel"><h2>Enter your phone number.</h2></label>
      <input type="tel" id="tel" name="number" placeholder="+255XXXXXXXXX" required>
      <div class="validation-error" id="number-error"></div>
    </div>
    
    <div class="sex">
      <label for="sex"><h2>Choose your sex</h2></label>
      <select name="sex" id="sex">
        <option value="Male">Male</option>
        <option value="Male">Female</option>
      </select>
    </div>
    
    <div class="photo" id="previewContainer">
      <h2>Upload your profile photo.</h2>
      <p>Your profile photo enable easy recognition with friends and relatives.</p>
      
      <div class="upload-container">
      <input type="file" accept="image/*" id="photo" name="profile_pic">
      <label for="photo" class="file-label">Choose a profile picture</label>
     
      <div class="preview-container" id="previewContainer">
      <img id="image" src="#">
    </div>
         
      </div>
        <div id="message" class="message"></div>
      </div>
      
        <div class="password">
      <label for="password"><h2>Enter your password.</h2></label>
      <p>Choose a strong password and easy for you to remember.</p>
          <input type="password" name="password" id="password" class="password-in" placeholder="Password"required>
          <div class="validation-error" id="password-error"></div>
      <p> 
        <ul>
          <li>It should contain 10 to 15 characters</li>
          <li>At least one capital letter</li>
          <li>At least one special letter</li>
          <li>At least one number</li>
        </ul>
      </p>
    </div>
    
    <div class="password">
      <label for="password2"><h2>Confirm your password.</h2></label>
      <input type="password" name="password" id="password2" class="password-in" placeholder="Confirm your password">
      <div class="validation-error" id="confirm-password-error"></div>
    </div>
    
    <div class="show-hide">
      <input type="checkbox" id="showPassword">
      <label for="showPassword">Show Password</label>
    </div>
    
    <button type="submit" name="Btn">Sign in</button>
    
    <div class="check">
    <label>Already have an account <a href="/login">Login</a></label>
    </div>
  </form>
  
  <script>
    document.addEventListener('DOMContentLoaded', ()=>{
      //Form elements
      const form = document.querySelector('form');
      const flashBox = document.querySelector('.flash-container');
      const message = document.querySelector('.flashed-message');
      
      //Input fields
      const usernameInput = document.getElementById('username');
      const emailInput = document.getElementById('email');
      const numberInput = document.getElementById('tel');
      const passwords = document.querySelectorAll('.password-in');
      const password1 = document.querySelector('#password');
      const password2 = document.querySelector('#password2');
      const checkbox = document.querySelector('#showPassword');
      
      // Error displays
      const usernameError = document.getElementById('username-error');
      const emailError = document.getElementById('email-error');
      const numberError = document.getElementById('number-error');
      const passwordError = document.getElementById('password-error');
      const confirmPasswordError = document.getElementById('confirm-password-error');
      
      //Photo upload elements
      const fileInput = document.getElementById('photo');
      const uploadButton = document.getElementById('uploadButton');
      const previewContainer = document.getElementById('previewContainer');
      const image = document.getElementById('image');
      
      fileInput.addEventListener('change', function(){
        const file = this.files[0];
        
        if(file){
          // Validate file type
          if (!file.type.startsWith('image/')) {
            showFlashMessage('Please select an image file');
            this.value = '';
            return;
        }
        
        // Validate file size (max 5MB)
        if (file.size > 5 * 1024 * 1024) {
            showFlashMessage('Image size should be less than 5MB');
            this.value = '';
            return;
        }
          
        const reader = new FileReader();
        
        reader.addEventListener('load', function(){
          image.src = reader.result;
          previewContainer.style.display = 'block';
        });
        
        reader.readAsDataURL(file);
        }
      });
      
      checkbox.addEventListener('change', ()=>{
        passwords.forEach(password =>{
      password.type = checkbox.checked ? 'text' : 'password';
        });
      });
      
      // Real-time validation for password strength
      password1.addEventListener('input', () => {
        validatePasswordStrength(password1.value);
      });
      
      // Real-time validation for password confirmation
      password2.addEventListener('input', () => {
        validatePasswordConfirmation();
      });
      
      // Form submission handler
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        if (validateForm()) {
          // If validation passes, submit the form
          this.submit();
        }
      });
      
      // Function to validate the entire form
      function validateForm() {
        let isValid = true;
        
        // Reset error messages
        hideAllErrors();
        
        // Validate username
        if (usernameInput.value.trim().length < 3) {
          showError(usernameError, 'Username must be at least 3 characters long');
          isValid = false;
        }
        
        // Validate email
        if (!isValidEmail(emailInput.value)) {
          showError(emailError, 'Please enter a valid email address');
          isValid = false;
        }
        
        // Validate phone number
        if (!isValidPhoneNumber(numberInput.value)) {
          showError(numberError, 'Please enter a valid phone number');
          isValid = false;
        }
        
        // Validate password strength
        if (!validatePasswordStrength(password1.value)) {
          isValid = false;
        }
        
        // Validate password confirmation
        if (!validatePasswordConfirmation()) {
          isValid = false;
        }
        
        return isValid;
      }
      
      // Function to validate password strength
      function validatePasswordStrength(password) {
        hideError(passwordError);
        
        if (password.length < 10 || password.length > 15) {
          showError(passwordError, 'Password must be between 10-15 characters');
          return false;
        }
        
        if (!/[A-Z]/.test(password)) {
          showError(passwordError, 'Password must contain at least one capital letter');
          return false;
        }
        
        if (!/[!@#$%^&*(),.?":{}|<>]/.test(password)) {
          showError(passwordError, 'Password must contain at least one special character');
          return false;
        }
        
        if (!/\d/.test(password)) {
          showError(passwordError, 'Password must contain at least one number');
          return false;
        }
        
        return true;
      }
      
      // Function to validate password confirmation
      function validatePasswordConfirmation() {
        hideError(confirmPasswordError);
        
        if (password1.value !== password2.value) {
          showError(confirmPasswordError, 'Passwords do not match');
          return false;
        }
        
        return true;
      }
      
      // Helper function to validate email format
      function isValidEmail(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
      }
      
      // Helper function to validate phone number format
      function isValidPhoneNumber(phone) {
        const phoneRegex = /^\+?[0-9]{10,15}$/;
        return phoneRegex.test(phone.replace(/\s/g, ''));
      }
      
      // Helper function to show error message
      function showError(element, message) {
        element.textContent = message;
        element.style.display = 'block';
      }
      
      // Helper function to hide error message
      function hideError(element) {
        element.textContent = '';
        element.style.display = 'none';
      }
      
      // Helper function to hide all error messages
      function hideAllErrors() {
        hideError(usernameError);
        hideError(emailError);
        hideError(numberError);
        hideError(passwordError);
        hideError(confirmPasswordError);
        flashBox.style.display = 'none';
      }
      
      // Function to show flash message
      function showFlashMessage(msg) {
        message.textContent = msg;
        flashBox.style.display = 'flex';
        
        // Auto-hide after 5 seconds
        setTimeout(() => {
          flashBox.style.display = 'none';
        }, 5000);
      }
      
    });
  
  /* // Add form submit event listener
      form.addEventListener('submit', function(e) {
        if (!checkPassword()) {
          e.preventDefault(); // Prevent form submission if validation fails
        }
      });
  
     // Add input event listeners to hide error when user starts typing
      [password1, password2].forEach(input => {
        input.addEventListener('input', () => {
          flashBox.style.display = 'none';
       
      });
    });
  
  function checkPassword(){
    const entry1 = password1.value.trim();
    const entry2 = password2.value.trim();
    
    if(entry1 !== entry2){
      showFlashMessage('Passwords do not match. Please confirm your password.');
      return false;
    }
    
    // Check password strength requirements
    if(!validatePasswordStrength(entry1)){
      showFlashMessage('Password does not meet the strength requirements.');
      return false;
    }
    
    return true;
  };
  
  function validatePasswordStrength(password) {
    // Check length (15-20 characters)
    if (password.length < 15 || password.length > 20) {
      return false;
    }
    
    // Check for at least one capital letter
    if (!/[A-Z]/.test(password)) {
      return false;
    }
    
    // Check for at least one special character
    if (!/[!@#$%^&*(),.?":{}|<>]/.test(password)) {
      return false;
    }
    
    // Check for at least one number
    if (!/\d/.test(password)) {
      return false;
    }
    
    return true;
  }
  
  function showFlashMessage(msg) {
    const flashBox = document.querySelector('.flash-container');
    const message = document.querySelector('.flashed-message');
    
    message.textContent = msg;
    flashBox.style.display = 'flex';
    
    // Auto-hide after 5 seconds
    setTimeout(() => {
      flashBox.style.display = 'none';
    }, 5000);
  }*/
  
  
  </script>
</body>
</html>
